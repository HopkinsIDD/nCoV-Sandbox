---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

```{r}
#Preamble
require(knitr)
require(tidyverse)
```

# Planning Notes/Ideas

- Apply basic framework to data so far, focusing on final size first
- Also do some basic epi summaries
    - here is a place for cool visulizations.
- Focus on province/state level in China (including Hong Kong/Macau SAR)
- Run this as a very open excercise in open science.
- Take snapshots of data...starting with stuff from : https://docs.google.com/spreadsheets/d/1jS24DjSPVWa4iuxuD4OAXrE3QeI8c9BC1hSlqr-NMiU/edit#gid=1449891965.
- Get total case snapshot from https://docs.google.com/spreadsheets/d/169AP3oaJZSMTquxtrkgFYMSp4gTApLTTWqo25qCpjL0/edit#gid=975486030
- Basically take snapshots and then post.
- Longer term...use approach and inference stuff for effect of actions.
- Keep a database of dates of intervention actions, major events.
    - 1/22/2020 : Wuhan Quarintine


## Some Tasks
- Download first snapshot, do some basic data cleaning and epi summaries.
- Do some data cleaning and loading
- Make some basic summaries
- Get province level covariates
    - population
    - population density
      - average/high/low
    - Average Feb temperature
    - Average/high-low Absolute humidity
    - Basic demographics (if available)
    - [OTHER WEATHER]
    - [OTHER INDEXES OF URBANIZATOIN/ECONOMY]

- Get the most basic model work

## Basic Epi Summary 1-23-2020


Age distribution of cases. 
```{r}
  source("R/DataLoadUtils.r")

  kudos <- readKudos("data/Kudos Line List-1-23-2020.csv") %>%
   mutate(age_cat = cut(Age, seq(0,100,10)))
  
  #Age distribution of cases.
  require(ggplot2)
  ggplot(kudos, aes(x=Age, fill=dead)) + 
    geom_histogram(breaks=seq(0,100,10), color="grey")
  

```

Lookat teh odds of death by gender and age. 

```{r}


  
  gender_odds <- kudos%>%group_by(Gender, dead)%>%
    summarize(n())%>%
    mutate(dead=ifelse(dead,"dead","alive"))%>%
    pivot_wider(names_from = dead,values_from=`n()`)%>%
    mutate(OR=dead/alive)
  
  gender_odds <- gender_odds%>%mutate(OR=OR/gender_odds$OR[1])
  
  kable(gender_odds, digits=2)
  
  age_odds <- kudos %>%
    group_by(age_cat,dead)%>%
    summarize(n())%>%
    mutate(dead=ifelse(dead,"dead","alive"))%>%
    pivot_wider(names_from = dead,values_from=`n()`)%>%
    mutate(OR=dead/alive)

  age_odds <- age_odds%>%mutate(OR=OR/age_odds$OR[5])
  
  
  kable(age_odds)
```

Epidemic curve of line list cases by location.

```{r}
  ggplot(kudos, aes(x=onset)) + geom_bar()

```
Now look at each locations curve in the line list data.
```{r}
 ggplot(kudos, aes(x=onset)) + geom_bar() + facet_wrap(.~Location)
```
